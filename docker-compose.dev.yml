# Docker Compose simplificado para desarrollo
# Oracle Database + Symfony Backend

services:
  # Oracle Database Express Edition
  oracle:
    image: container-registry.oracle.com/database/express:21.3.0-xe
    container_name: caprino_oracle_dev
    network_mode: host
    environment:
      - ORACLE_PWD=OraclePassword123
      - ORACLE_CHARACTERSET=AL32UTF8
    volumes:
      - oracle_dev_data:/opt/oracle/oradata
      - ./base-de-datos:/docker-entrypoint-initdb.d:ro
    healthcheck:
      test: ["CMD-SHELL", "echo 'SELECT 1 FROM DUAL;' | sqlplus -L sys/OraclePassword123@//localhost:1521/XEPDB1 as sysdba"]
      interval: 30s
      timeout: 10s
      retries: 5
      start_period: 60s

  # Backend Symfony
  symfony:
    build:
      context: ./backend-symfony
      dockerfile: Dockerfile
    container_name: caprino_symfony_dev
    network_mode: host
    volumes:
      - ./backend-symfony:/app:cached
      - symfony_vendor:/app/vendor
    environment:
      - APP_ENV=dev
      - DATABASE_URL=oci8://caprino_user:CaprinoPass2025@localhost:1521/XEPDB1
    depends_on:
      oracle:
        condition: service_started
    command: symfony server:start --no-tls --port=8000 --allow-http

volumes:
  oracle_dev_data:
    driver: local
  symfony_vendor:
    driver: local
